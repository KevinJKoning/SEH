<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Naive Monte Carlo – Statistics for Engineers in a Hurry (an Illustrated Primer)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2204267ba3465bf97d1f19466c0824b7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.9.3/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.9.3/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.9.3/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Statistics for Engineers in a Hurry (an Illustrated Primer)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Naive Monte Carlo</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./2-data_generation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability of Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2.1-discrete_probability_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Discrete Probability Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2.2-continuous-probability-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous Probability Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2.3-statistical_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2.4-machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Machine Learning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./3-parameter_estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Likelihood of Model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3.1-without_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Without Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3.2-with_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">With Priors</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#bayesian-methods" id="toc-bayesian-methods" class="nav-link" data-scroll-target="#bayesian-methods">Bayesian Methods</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#priors" id="toc-priors" class="nav-link" data-scroll-target="#priors">Priors</a></li>
  <li><a href="#less-naive-monte-carlo" id="toc-less-naive-monte-carlo" class="nav-link" data-scroll-target="#less-naive-monte-carlo">Less Naive Monte Carlo</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Naive Monte Carlo</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="intro" class="level2">
<h2 class="anchored" data-anchor-id="intro">Intro</h2>
<p>We use the term <em>naive</em> to distinguish this method from more advanced Monte Carlo methods. The advantage here will be simplicity, but it will not be a good solution with many parameters (due to the spareseness of high dimensional space), or where we do not have good priors.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re wondering why generate data for examples instead of using ‘real’ data sets, it’s because it’s the only way to have certainty in the data generating process. This allows us to see how well we fit the model. Obviously the goal is real data - but unfortunately you’ll probably never know <em>exactly</em> what the data generating process was, and that makes understanding the accuracy of ‘new’ methods very difficult.</p>
</div>
</div>
</section>
<section id="bayesian-methods" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-methods">Bayesian Methods</h2>
<p>For determining the <span class="math inline">\(P(M|D)\)</span>, we will use Bayesian methods. There’s a whole historical debate you could research, but when it comes to most scientific and engineering subjects, you wouldn’t be studying the subject if you didn’t have some prior information, even if you can only describe it as intuition. This prior information is valuable, and it should be included in the model. Priors are also valueable in more bespoke models due to their ability to limit solutions to those known to be plausible…</p>
<p>Allen Downey said it well when he stated in <em>Think Bayes</em> that if don’t have much data you should use Bayesian methods, and when you have lots of data, it dominates the priors so you can still use Bayesian methods… (research the real quote).</p>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<div id="4cc693f5" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Generate Data</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># True parameters</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>mu_true <span class="op">=</span> <span class="fl">5.5</span>  <span class="co"># average height in feet</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>sigma_true <span class="op">=</span> <span class="fl">0.3</span>  <span class="co"># standard deviation in feet</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate dataset of 100 persons</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>dataset_size <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>heights <span class="op">=</span> np.random.normal(loc<span class="op">=</span>mu_true, scale<span class="op">=</span>sigma_true, size<span class="op">=</span>dataset_size)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the generated heights</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>sns.histplot(heights, bins<span class="op">=</span><span class="dv">15</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'skyblue'</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Histogram of Generated Heights (100 Persons)'</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Height (feet)'</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="3.X-Naive_Monte_Carlo_files/figure-html/cell-2-output-1.png" width="821" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="priors" class="level2">
<h2 class="anchored" data-anchor-id="priors">Priors</h2>
<div id="f7fbc110" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Define Priors (Corrected)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define prior ranges</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>mu_prior_min <span class="op">=</span> <span class="fl">4.0</span>  <span class="co"># feet</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>mu_prior_max <span class="op">=</span> <span class="fl">7.0</span>  <span class="co"># feet</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sigma_prior_min <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>sigma_prior_max <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> sigma_true  <span class="co"># 0.9 feet</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the prior distributions</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior for mu</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>mu_values <span class="op">=</span> np.linspace(mu_prior_min, mu_prior_max, <span class="dv">1000</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>mu_prior <span class="op">=</span> np.ones_like(mu_values) <span class="op">/</span> (mu_prior_max <span class="op">-</span> mu_prior_min)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(mu_values, mu_prior, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="vs">r'Prior Distribution for $\mu$ (Mean Height)'</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="vs">r'$\mu$ (feet)'</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">'Probability Density'</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior for sigma</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>sigma_values <span class="op">=</span> np.linspace(sigma_prior_min, sigma_prior_max, <span class="dv">1000</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>sigma_prior_dist <span class="op">=</span> np.ones_like(sigma_values) <span class="op">/</span> (sigma_prior_max <span class="op">-</span> sigma_prior_min)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(sigma_values, sigma_prior_dist, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="vs">r'Prior Distribution for $\sigma$ (Std Dev)'</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="vs">r'$\sigma$ (feet)'</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">'Probability Density'</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="3.X-Naive_Monte_Carlo_files/figure-html/cell-3-output-1.png" width="1127" height="452" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d35039cb" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Sample from Priors</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of samples</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>num_prior_samples <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample mu and sigma from their priors</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>mu_samples <span class="op">=</span> np.random.uniform(mu_prior_min, mu_prior_max, num_prior_samples)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>sigma_samples <span class="op">=</span> np.random.uniform(sigma_prior_min, sigma_prior_max, num_prior_samples)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># To avoid sigma=0, set a minimum sigma</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>sigma_samples[sigma_samples <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate heights based on sampled mu and sigma</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>heights_prior <span class="op">=</span> np.random.normal(loc<span class="op">=</span>mu_samples, scale<span class="op">=</span>sigma_samples)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the prior-generated heights</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>sns.histplot(heights_prior, bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Histogram of Heights Generated from Priors (10,000 Persons)'</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Height (feet)'</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="3.X-Naive_Monte_Carlo_files/figure-html/cell-4-output-1.png" width="816" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="87d4f6cc" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Naive Monte Carlo (Corrected)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Precompute constants</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(heights)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> heights</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorized computation of log-likelihoods</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># There's a hell of a lot happening in this one line. For each of the 10,000 random samples</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># from the prior, it is using each as the loc and scale of a norm dist to find the </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood of getting the height data. Then summing the 100 to get a 10,000 lenth array</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>log_likelihoods <span class="op">=</span> norm.logpdf(data[:, np.newaxis], loc<span class="op">=</span>mu_samples, scale<span class="op">=</span>sigma_samples).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># To prevent numerical underflow, we'll work with log-likelihoods</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize log-likelihoods by subtracting the max</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>max_log_likelihood <span class="op">=</span> np.<span class="bu">max</span>(log_likelihoods)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>normalized_log_likelihood <span class="op">=</span> log_likelihoods <span class="op">-</span> max_log_likelihood</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>likelihoods <span class="op">=</span> np.exp(normalized_log_likelihood)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute posterior probabilities (unnormalized)</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Due to flat priors posterior is just equivalent to the likelihoods</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>posterior <span class="op">=</span> likelihoods</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the posterior (so it sums to 1)</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>posterior <span class="op">/=</span> np.<span class="bu">sum</span>(posterior)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify that 'posterior' is one-dimensional</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Shape of posterior: </span><span class="sc">{</span>posterior<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame for easier handling</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mu'</span>: mu_samples,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sigma'</span>: sigma_samples,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'posterior'</span>: posterior</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the posterior distributions for mu and sigma using Seaborn</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot posterior for mu</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'mu'</span>, weights<span class="op">=</span><span class="st">'posterior'</span>, bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'purple'</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].axvline(mu_true, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="vs">r'True $\mu$'</span>)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="vs">r'Posterior Distribution for $\mu$'</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="vs">r'$\mu$ (feet)'</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">'Posterior Probability'</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot posterior for sigma</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'sigma'</span>, weights<span class="op">=</span><span class="st">'posterior'</span>, bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'brown'</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axvline(sigma_true, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="vs">r'True $\sigma$'</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="vs">r'Posterior Distribution for $\sigma$'</span>)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="vs">r'$\sigma$ (feet)'</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">'Posterior Probability'</span>)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape of posterior: (10000,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="3.X-Naive_Monte_Carlo_files/figure-html/cell-5-output-2.png" width="1334" height="467" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cc04b315" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Visualize Parameter Likelihood (Log-Scaled Color)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =========================</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a small epsilon to avoid log(0)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>epsilon <span class="op">=</span> <span class="fl">1e-10</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the logarithm of posterior probabilities</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>log_posterior <span class="op">=</span> np.log(posterior <span class="op">+</span> epsilon)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the scatter plot</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot using log_posterior for color scaling</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> plt.scatter(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    mu_samples,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    sigma_samples,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>log_posterior,          <span class="co"># Use log-transformed posterior</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'viridis'</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">10</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a colorbar with appropriate labeling</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(scatter)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Log Posterior Probability'</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference lines for true parameter values using raw strings</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>plt.axvline(mu_true, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="vs">r'True $\mu$'</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>plt.axhline(sigma_true, color<span class="op">=</span><span class="st">'blue'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="vs">r'True $\sigma$'</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plot titles and labels using raw strings</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="vs">r'Posterior Probability of $\mu$ and $\sigma$ (Log Scale)'</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$\mu$ (feet)'</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$\sigma$ (feet)'</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="3.X-Naive_Monte_Carlo_files/figure-html/cell-6-output-1.png" width="800" height="674" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Shiny Live!</p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 900

from shiny import App, ui, render, reactive
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from scipy.stats import norm
import pandas as pd

app_ui = ui.page_fluid(
    ui.h2("Bayesian Inference of Heights"),
    ui.layout_sidebar(
        ui.sidebar(
            ui.h4("True Parameters"),
            ui.input_numeric(
                "mu_true", 
                "True Mean Height (μ_true) [feet]", 
                value=5.5, 
                min=4.0, 
                max=7.0, 
                step=0.1
            ),
            ui.input_numeric(
                "sigma_true", 
                "True Std Dev (σ_true) [feet]", 
                value=0.3, 
                min=0.1, 
                max=1.0, 
                step=0.05
            ),
            ui.hr(),
            ui.h4("Dataset Generation"),
            ui.input_numeric(
                "dataset_size", 
                "Number of Persons", 
                value=100, 
                min=10, 
                max=1000, 
                step=10
            ),
            ui.hr(),
            ui.h4("Prior Ranges"),
            ui.input_numeric(
                "mu_prior_min", 
                "μ Prior Minimum [feet]", 
                value=4.0, 
                min=0.0, 
                max=6.0, 
                step=0.1
            ),
            ui.input_numeric(
                "mu_prior_max", 
                "μ Prior Maximum [feet]", 
                value=7.0, 
                min=5.0, 
                max=10.0, 
                step=0.1
            ),
            ui.input_numeric(
                "sigma_prior_min", 
                "σ Prior Minimum [feet]", 
                value=0.0, 
                min=0.0, 
                max=1.0, 
                step=0.05
            ),
            ui.input_numeric(
                "sigma_prior_max", 
                "σ Prior Maximum [feet]", 
                value=0.9, 
                min=0.5, 
                max=3.0, 
                step=0.1
            ),
            ui.hr(),
            ui.h4("Sampling"),
            ui.input_numeric(
                "num_prior_samples", 
                "Number of Prior Samples", 
                value=10000, 
                min=1000, 
                max=100000, 
                step=1000
            ),
        ),
        ui.navset_tab(
            ui.nav_panel("Generated Data", ui.output_plot("generated_heights_plot")),
            ui.nav_panel("Prior Distributions", ui.output_plot("prior_distributions_plot")),
            ui.nav_panel("Prior-Generated Heights", ui.output_plot("prior_generated_heights_plot")),
            ui.nav_panel("Posterior Distributions", ui.output_plot("posterior_distributions_plot")),
            ui.nav_panel("Parameter Scatter Plot", ui.output_plot("parameter_scatter_plot")),
        )

    )
)

def server(input, output, session):
    # Reactive expression to generate dataset
    @reactive.Calc
    def heights():
        np.random.seed(42)  # For reproducibility
        mu = input.mu_true()
        sigma = input.sigma_true()
        size = input.dataset_size()
        return np.random.normal(loc=mu, scale=sigma, size=size)
    
    # Reactive expressions for prior ranges
    @reactive.Calc
    def mu_prior_range():
        return (input.mu_prior_min(), input.mu_prior_max())
    
    @reactive.Calc
    def sigma_prior_range():
        return (input.sigma_prior_min(), input.sigma_prior_max())
    
    # Reactive expression to sample from priors
    @reactive.Calc
    def prior_samples():
        num_samples = input.num_prior_samples()
        mu_min, mu_max = mu_prior_range()
        sigma_min, sigma_max = sigma_prior_range()
        
        mu_samples = np.random.uniform(mu_min, mu_max, num_samples)
        sigma_samples = np.random.uniform(sigma_min, sigma_max, num_samples)
        # Avoid sigma=0
        sigma_samples[sigma_samples == 0] = 1e-6
        return mu_samples, sigma_samples
    
    # Reactive expression to generate heights from priors
    @reactive.Calc
    def heights_prior_samples():
        mu_samples, sigma_samples = prior_samples()
        return np.random.normal(loc=mu_samples, scale=sigma_samples)
    
    # Reactive expression to compute posterior
    @reactive.Calc
    def posterior():
        data = heights()
        mu_samples, sigma_samples = prior_samples()
        n = len(data)
        
        # Compute log-likelihoods
        log_likelihoods = norm.logpdf(data[:, np.newaxis], loc=mu_samples, scale=sigma_samples).sum(axis=0)
        
        # Normalize log-likelihoods to prevent underflow
        max_log_likelihood = np.max(log_likelihoods)
        normalized_log_likelihood = log_likelihoods - max_log_likelihood
        likelihoods = np.exp(normalized_log_likelihood)
        
        # Posterior probabilities (unnormalized)
        posterior_probs = likelihoods
        
        # Normalize posterior
        posterior_probs /= np.sum(posterior_probs)
        
        return posterior_probs
    
    # Reactive expression to create DataFrame for posterior
    @reactive.Calc
    def posterior_df():
        mu_samples, sigma_samples = prior_samples()
        posterior_probs = posterior()
        return pd.DataFrame({
            'mu': mu_samples,
            'sigma': sigma_samples,
            'posterior': posterior_probs
        })
    
    # Plot 1: Generated Heights Histogram
    @output
    @render.plot
    def generated_heights_plot():
        data = heights()
        plt.figure(figsize=(8, 5))
        sns.histplot(data, bins=15, kde=True, color='skyblue')
        plt.title(f'Histogram of Generated Heights ({input.dataset_size()} Persons)')
        plt.xlabel('Height (feet)')
        plt.ylabel('Frequency')
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 2: Prior Distributions for mu and sigma
    @output
    @render.plot
    def prior_distributions_plot():
        mu_min, mu_max = mu_prior_range()
        sigma_min, sigma_max = sigma_prior_range()
        
        fig, ax = plt.subplots(1, 2, figsize=(14, 5))
        
        # Prior for mu
        mu_values = np.linspace(mu_min, mu_max, 1000)
        mu_prior = np.ones_like(mu_values) / (mu_max - mu_min)
        ax[0].plot(mu_values, mu_prior, color='blue')
        ax[0].set_title(r'Prior Distribution for $\mu$ (Mean Height)')
        ax[0].set_xlabel(r'$\mu$ (feet)')
        ax[0].set_ylabel('Probability Density')
        
        # Prior for sigma
        sigma_values = np.linspace(sigma_min, sigma_max, 1000)
        sigma_prior_dist = np.ones_like(sigma_values) / (sigma_max - sigma_min)
        ax[1].plot(sigma_values, sigma_prior_dist, color='green')
        ax[1].set_title(r'Prior Distribution for $\sigma$ (Std Dev)')
        ax[1].set_xlabel(r'$\sigma$ (feet)')
        ax[1].set_ylabel('Probability Density')
        
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 3: Heights Generated from Priors
    @output
    @render.plot
    def prior_generated_heights_plot():
        heights_prior = heights_prior_samples()
        plt.figure(figsize=(8, 5))
        sns.histplot(heights_prior, bins=50, kde=True, color='orange')
        plt.title(f'Histogram of Heights Generated from Priors ({input.num_prior_samples()} Persons)')
        plt.xlabel('Height (feet)')
        plt.ylabel('Frequency')
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 4: Posterior Distributions for mu and sigma
    @output
    @render.plot
    def posterior_distributions_plot():
        df = posterior_df()
        mu_true = input.mu_true()
        sigma_true = input.sigma_true()
        
        fig, ax = plt.subplots(1, 2, figsize=(14, 5))
        
        # Posterior for mu
        sns.histplot(data=df, x='mu', weights='posterior', bins=50, kde=True, color='purple', ax=ax[0])
        ax[0].axvline(mu_true, color='red', linestyle='--', label=r'True $\mu$')
        ax[0].set_title(r'Posterior Distribution for $\mu$')
        ax[0].set_xlabel(r'$\mu$ (feet)')
        ax[0].set_ylabel('Posterior Probability')
        ax[0].legend()
        
        # Posterior for sigma
        sns.histplot(data=df, x='sigma', weights='posterior', bins=50, kde=True, color='brown', ax=ax[1])
        ax[1].axvline(sigma_true, color='red', linestyle='--', label=r'True $\sigma$')
        ax[1].set_title(r'Posterior Distribution for $\sigma$')
        ax[1].set_xlabel(r'$\sigma$ (feet)')
        ax[1].set_ylabel('Posterior Probability')
        ax[1].legend()
        
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 5: Scatter Plot of mu vs sigma with Log Posterior Probability
    @output
    @render.plot
    def parameter_scatter_plot():
        df = posterior_df()
        mu_true = input.mu_true()
        sigma_true = input.sigma_true()
        
        epsilon = 1e-10  # To avoid log(0)
        log_posterior = np.log(df['posterior'] + epsilon)
        
        plt.figure(figsize=(10, 8))
        scatter = plt.scatter(
            df['mu'],
            df['sigma'],
            c=log_posterior,
            cmap='viridis',
            alpha=0.5,
            s=10
        )
        cbar = plt.colorbar(scatter)
        cbar.set_label('Log Posterior Probability')
        
        plt.axvline(mu_true, color='red', linestyle='--', label=r'True $\mu$')
        plt.axhline(sigma_true, color='blue', linestyle='--', label=r'True $\sigma$')
        
        plt.title(r'Posterior Probability of $\mu$ and $\sigma$ (Log Scale)')
        plt.xlabel(r'$\mu$ (feet)')
        plt.ylabel(r'$\sigma$ (feet)')
        plt.legend()
        plt.tight_layout()
        return plt.gcf()

app = App(app_ui, server)</code></pre>
<p>v2</p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 900

from shiny import App, ui, render, reactive
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from scipy.stats import norm
import pandas as pd

app_ui = ui.page_fluid(
    ui.h2("Bayesian Inference of Heights"),
    ui.row(
        ui.column(3,
            ui.h4("True Parameters"),
            ui.input_numeric(
                "mu_true", 
                "True Mean Height [feet]", 
                value=5.5, 
                min=4.0, 
                max=7.0, 
                step=0.1
            ),
            ui.input_numeric(
                "sigma_true", 
                "True Std Dev (σ_true) [feet]", 
                value=0.3, 
                min=0.1, 
                max=1.0, 
                step=0.05
            ),
        ),
        ui.column(3,
            ui.h4("Dataset Generation"),
            ui.input_numeric(
                "dataset_size", 
                "Number of Persons", 
                value=100, 
                min=10, 
                max=1000, 
                step=10
            ),
        ),
        ui.column(3,
            ui.h4("Prior Ranges"),
            ui.input_numeric(
                "mu_prior_min", 
                "μ Prior Minimum [feet]", 
                value=4.0, 
                min=0.0, 
                max=6.0, 
                step=0.1
            ),
            ui.input_numeric(
                "mu_prior_max", 
                "μ Prior Maximum [feet]", 
                value=7.0, 
                min=5.0, 
                max=10.0, 
                step=0.1
            ),
        ),
        ui.column(3,
            ui.h4("Prior Ranges &amp; Sampling"),
            ui.input_numeric(
                "sigma_prior_min", 
                "σ Prior Minimum [feet]", 
                value=0.0, 
                min=0.0, 
                max=1.0, 
                step=0.05
            ),
            ui.input_numeric(
                "sigma_prior_max", 
                "σ Prior Maximum [feet]", 
                value=0.9, 
                min=0.5, 
                max=3.0, 
                step=0.1
            ),
            ui.input_numeric(
                "num_prior_samples", 
                "Number of Prior Samples", 
                value=10000, 
                min=1000, 
                max=100000, 
                step=1000
            ),
        )
    ),
    ui.navset_tab(
        ui.nav_panel("True Height Data", ui.output_plot("generated_heights_plot")),
        ui.nav_panel("Prior", ui.output_plot("prior_distributions_plot")),
        ui.nav_panel("Prior-Generated Heights", ui.output_plot("prior_generated_heights_plot")),
        ui.nav_panel("Posterior", ui.output_plot("posterior_distributions_plot")),
        ui.nav_panel("Parameter Plot", ui.output_plot("parameter_scatter_plot")),
    )
)


def server(input, output, session):
    # Reactive expression to generate dataset
    @reactive.Calc
    def heights():
        np.random.seed(42)  # For reproducibility
        mu = input.mu_true()
        sigma = input.sigma_true()
        size = input.dataset_size()
        return np.random.normal(loc=mu, scale=sigma, size=size)
    
    # Reactive expressions for prior ranges
    @reactive.Calc
    def mu_prior_range():
        return (input.mu_prior_min(), input.mu_prior_max())
    
    @reactive.Calc
    def sigma_prior_range():
        return (input.sigma_prior_min(), input.sigma_prior_max())
    
    # Reactive expression to sample from priors
    @reactive.Calc
    def prior_samples():
        num_samples = input.num_prior_samples()
        mu_min, mu_max = mu_prior_range()
        sigma_min, sigma_max = sigma_prior_range()
        
        mu_samples = np.random.uniform(mu_min, mu_max, num_samples)
        sigma_samples = np.random.uniform(sigma_min, sigma_max, num_samples)
        # Avoid sigma=0
        sigma_samples[sigma_samples == 0] = 1e-6
        return mu_samples, sigma_samples
    
    # Reactive expression to generate heights from priors
    @reactive.Calc
    def heights_prior_samples():
        mu_samples, sigma_samples = prior_samples()
        return np.random.normal(loc=mu_samples, scale=sigma_samples)
    
    # Reactive expression to compute posterior
    @reactive.Calc
    def posterior():
        data = heights()
        mu_samples, sigma_samples = prior_samples()
        n = len(data)
        
        # Compute log-likelihoods
        log_likelihoods = norm.logpdf(data[:, np.newaxis], loc=mu_samples, scale=sigma_samples).sum(axis=0)
        
        # Normalize log-likelihoods to prevent underflow
        max_log_likelihood = np.max(log_likelihoods)
        normalized_log_likelihood = log_likelihoods - max_log_likelihood
        likelihoods = np.exp(normalized_log_likelihood)
        
        # Posterior probabilities (unnormalized)
        posterior_probs = likelihoods
        
        # Normalize posterior
        posterior_probs /= np.sum(posterior_probs)
        
        return posterior_probs
    
    # Reactive expression to create DataFrame for posterior
    @reactive.Calc
    def posterior_df():
        mu_samples, sigma_samples = prior_samples()
        posterior_probs = posterior()
        return pd.DataFrame({
            'mu': mu_samples,
            'sigma': sigma_samples,
            'posterior': posterior_probs
        })
    
    # Plot 1: Generated Heights Histogram
    @output
    @render.plot
    def generated_heights_plot():
        data = heights()
        plt.figure(figsize=(8, 5))
        sns.histplot(data, bins=15, kde=True, color='skyblue')
        plt.title(f'Histogram of Generated Heights ({input.dataset_size()} Persons)')
        plt.xlabel('Height (feet)')
        plt.ylabel('Frequency')
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 2: Prior Distributions for mu and sigma
    @output
    @render.plot
    def prior_distributions_plot():
        mu_min, mu_max = mu_prior_range()
        sigma_min, sigma_max = sigma_prior_range()
        
        fig, ax = plt.subplots(1, 2, figsize=(14, 5))
        
        # Prior for mu
        mu_values = np.linspace(mu_min, mu_max, 1000)
        mu_prior = np.ones_like(mu_values) / (mu_max - mu_min)
        ax[0].plot(mu_values, mu_prior, color='blue')
        ax[0].set_title(r'Prior Distribution for $\mu$ (Mean Height)')
        ax[0].set_xlabel(r'$\mu$ (feet)')
        ax[0].set_ylabel('Probability Density')
        
        # Prior for sigma
        sigma_values = np.linspace(sigma_min, sigma_max, 1000)
        sigma_prior_dist = np.ones_like(sigma_values) / (sigma_max - sigma_min)
        ax[1].plot(sigma_values, sigma_prior_dist, color='green')
        ax[1].set_title(r'Prior Distribution for $\sigma$ (Std Dev)')
        ax[1].set_xlabel(r'$\sigma$ (feet)')
        ax[1].set_ylabel('Probability Density')
        
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 3: Heights Generated from Priors
    @output
    @render.plot
    def prior_generated_heights_plot():
        heights_prior = heights_prior_samples()
        plt.figure(figsize=(8, 5))
        sns.histplot(heights_prior, bins=50, kde=True, color='orange')
        plt.title(f'Histogram of Heights Generated from Priors ({input.num_prior_samples()} Persons)')
        plt.xlabel('Height (feet)')
        plt.ylabel('Frequency')
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 4: Posterior Distributions for mu and sigma
    @output
    @render.plot
    def posterior_distributions_plot():
        df = posterior_df()
        mu_true = input.mu_true()
        sigma_true = input.sigma_true()
        
        fig, ax = plt.subplots(1, 2, figsize=(14, 5))
        
        # Posterior for mu
        sns.histplot(data=df, x='mu', weights='posterior', bins=50, kde=True, color='purple', ax=ax[0])
        ax[0].axvline(mu_true, color='red', linestyle='--', label=r'True $\mu$')
        ax[0].set_title(r'Posterior Distribution for $\mu$')
        ax[0].set_xlabel(r'$\mu$ (feet)')
        ax[0].set_ylabel('Posterior Probability')
        ax[0].legend()
        
        # Posterior for sigma
        sns.histplot(data=df, x='sigma', weights='posterior', bins=50, kde=True, color='brown', ax=ax[1])
        ax[1].axvline(sigma_true, color='red', linestyle='--', label=r'True $\sigma$')
        ax[1].set_title(r'Posterior Distribution for $\sigma$')
        ax[1].set_xlabel(r'$\sigma$ (feet)')
        ax[1].set_ylabel('Posterior Probability')
        ax[1].legend()
        
        plt.tight_layout()
        return plt.gcf()
    
    # Plot 5: Scatter Plot of mu vs sigma with Log Posterior Probability
    @output
    @render.plot
    def parameter_scatter_plot():
        df = posterior_df()
        mu_true = input.mu_true()
        sigma_true = input.sigma_true()
        
        epsilon = 1e-10  # To avoid log(0)
        log_posterior = np.log(df['posterior'] + epsilon)
        
        plt.figure(figsize=(10, 8))
        scatter = plt.scatter(
            df['mu'],
            df['sigma'],
            c=log_posterior,
            cmap='viridis',
            alpha=0.5,
            s=10
        )
        cbar = plt.colorbar(scatter)
        cbar.set_label('Log Posterior Probability')
        
        plt.axvline(mu_true, color='red', linestyle='--', label=r'True $\mu$')
        plt.axhline(sigma_true, color='blue', linestyle='--', label=r'True $\sigma$')
        
        plt.title(r'Posterior Probability of $\mu$ and $\sigma$ (Log Scale)')
        plt.xlabel(r'$\mu$ (feet)')
        plt.ylabel(r'$\sigma$ (feet)')
        plt.legend()
        plt.tight_layout()
        return plt.gcf()

app = App(app_ui, server)</code></pre>
</section>
<section id="less-naive-monte-carlo" class="level2">
<h2 class="anchored" data-anchor-id="less-naive-monte-carlo">Less Naive Monte Carlo</h2>
<p>If you paid attention to the Posterior Probability of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> plot, you probabiliy noticed that a <em>lot</em> of the points/space on the chart was consumed by areas of low probability. This was true even though we had few parameters (low dimensions) and good priors. The trick of the more advanced Monte Carlo techniques is how to find the areas of high likelihood and sample them efficiently. These include Hamiltonian Monte Carlo (HMC) and the No-U-Turn Sampler (NUTS). We’ll use em, and thankfully the details are easily researched if you want to know more…</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>